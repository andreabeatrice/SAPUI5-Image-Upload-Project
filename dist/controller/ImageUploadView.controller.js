sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/upload/Uploader","sap/ui/core/Fragment"],function(e,o,t,r){"use strict";return e.extend("imageuploadproject.controller.ImageUploadView",{onInit:function(){this.byId("problemInfoStrip").setVisible(false);localStorage.setItem("cropped",false)},onImageLoaded:function(){var e=this.byId("fileUploader").oFileUpload;console.log(typeof localStorage.getItem("cropped"));if(localStorage.getItem("cropped")==="false"){this.cropImage();this.onOpenDialog()}},onOpenDialog:function(){if(!this.pDialog){this.pDialog=this.loadFragment({name:"imageuploadproject.view.BusyDialog"})}this.pDialog.then(function(e){e.open()})},cropImage:function(){var e=this;var o=this.byId("problemInfoStrip");var t=this.byId("fileUploader").oFileUpload;var r=t.files[0];var a=new FileReader;a.onload=function(t){var r=new Blob([t.target.result]);var a=new Headers;a.append("Ocp-Apim-Subscription-Key","7ed21d6720754ade9dac6191b9b26e9a");a.append("Content-Type","application/octet-stream");var s={method:"POST",headers:a,body:r,redirect:"follow"};fetch("https://nedbankcropimage.cognitiveservices.azure.com/vision/v3.2/generateThumbnail?smartCropping=true&width=1000&height=1000",s).then(e=>e.blob()).then(t=>{console.log(t);const r=URL.createObjectURL(t);const a=e.getView().byId("imageEd");a.setSrc(r);localStorage.setItem("cropped",true);if(e.pDialog){e.pDialog.then(function(e){e.close()})}o.setText("Profile Image has been successfully uploaded");o.setType("Success");o.setVisible(true);a.onerror=()=>{o.setText("Not uploaded— The profile image is larger than 4Mb. <br><br> <strong>Upload a new image that meets the following standards:</strong> <br> *Your picture must contain an identifiable face. <br> *Your picture should only have one (1) person in it. <br> *You shouldn't have glasses, sunglasses, or a mask on in your picture. <br> *You should be easily recognizable in your picture. <br> *The Image should not be larger than 4Mb.");o.setType("Error");o.setVisible(true);e.getView().byId("image").setSrc("")}}).catch(e=>{console.log(e)})};a.onerror=function(e){console.log("Error : "+e.type)};a.readAsArrayBuffer(r)},handleUploadPress:function(){var e=this;var o=this.byId("fileUploader").oFileUpload;var t=o.files[0];var r=this.getView().byId("imageEd");r.getImageAsBlob().then(function(o){if(o){e.sendToAPI(e,o);localStorage.setItem("profileImage",window.URL.createObjectURL(o))}else{e.sendToAPI(e,t);console.log(o)}})},sendToAPI:function(e,o){var t=new FileReader;t.onload=function(o){console.log(o.target.result);var t=new Blob([o.target.result]);var r=new Headers;r.append("Ocp-Apim-Subscription-Key","0e9bb2dd6b654978889f5ac9ddd858f1");r.append("Content-Type","application/octet-stream");var a={method:"POST",headers:r,body:t,redirect:"follow"};fetch("https://bankimagefaceapi.cognitiveservices.azure.com/face/v1.0/detect?returnFaceId=false&returnFaceAttributes=glasses,qualityForRecognition&returnFaceLandmarks=true&recognitionModel=recognition_04&returnRecognitionModel=false&detectionModel=detection_01",a).then(e=>e.text()).then(o=>e.readValues(o)).catch(e=>console.log("error",e))};t.onerror=function(e){console.log("Error : "+e.type)};t.readAsArrayBuffer(o)},handleTypeMissmatch:function(e){var o=e.getSource().getFileType();o.map(function(e){return"*."+e});this.byId("problemInfoStrip").setText("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+o.join(", "));this.byId("problemInfoStrip").setType("Error");this.byId("problemInfoStrip").setVisible(true)},handleValueChange:function(e){var o=e.getParameter("files")[0];this.byId("imageEd").setSrc(o);localStorage.setItem("cropped",false)},readValues:function(e){var o=JSON.parse(e);var t=this.byId("problemInfoStrip");console.log(o);if(o.error){t.setText("Not uploaded. There was an error");t.setType("Error");t.setVisible(true)}else if(o==""){t.setText("Not uploaded—the picture you uploaded doesn't contain an identifiable face. <br><br> <strong>Upload a new image that meets the following standards:</strong> <br> *Your picture must contain an identifiable face. <br> *Your picture should only have one (1) person in it. <br> *You shouldn't have glasses, sunglasses, or a mask on in your picture. <br> *You should be easily recognizable in your picture. <br><br> If the system is consistently not identifying your face, or you wear a face covering for religious resons, <a target='_blank' href='http://www.sap.com'>request a review here</a>.");t.setType("Error");t.setVisible(true)}else{for(var r in o){var a=o[r].faceAttributes.glasses;var s=o[r].faceAttributes.qualityForRecognition;if(r>0){t.setText("Not uploaded—you should be the only person in your profile picture. <br><br> <strong>Upload a new image that meets the following standards:</strong> <br> *Your picture must contain an identifiable face. <br> *Your picture should only have one (1) person in it. <br> *You shouldn't have glasses, sunglasses, or a mask on in your picture. <br> *You should be easily recognizable in your picture.");t.setType("Error");t.setVisible(true)}else if(o.length==1&&a=="ReadingGlasses"||a=="sunglasses"){t.setText("Not uploaded—your profile picture must not contain glasses <br><br> <strong>Upload a new image that meets the following standards:</strong> <br> *Your picture must contain an identifiable face. <br> *Your picture should only have one (1) person in it. <br> *You shouldn't have glasses, sunglasses, or a mask on in your picture. <br> *You should be easily recognizable in your picture.");t.setType("Error");t.setVisible(true)}else if(o.length==1&&a=="NoGlasses"&&s=="high"){t.setText("Profile Image has been successfully uploaded");t.setType("Success");t.setVisible(true);this.getView().byId("img").setSrc(localStorage.getItem("profileImage"))}else{t.setText("Not uploaded—you are not recognizable in this image. <br><br> <strong>Upload a new image that meets the following standards:</strong> <br> *Your picture must contain an identifiable face. <br> *Your picture should only have one (1) person in it. <br> *You shouldn't have glasses, sunglasses, or a mask on in your picture. <br> *You should be easily recognizable in your picture.  <br><br> If the system is consistently not identifying your face, or you wear a face covering for religious resons, <a target='_blank' href='http://www.sap.com'>request a review here</a>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ");t.setType("Error");t.setVisible(true)}}}}})});
//# sourceMappingURL=ImageUploadView.controller.js.map